{% extends 'base.html' %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">Auditoria do Sistema</h1>

<form method="get" action="/auditoria" class="mb-4 bg-white p-4 rounded shadow">
  <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
    <div>
      <label class="block text-sm mb-1">Usuário</label>
      <select name="usuario_id" class="w-full border rounded px-3 py-2">
        <option value="">Todos</option>
        {% for u in usuarios %}
          <option value="{{ u.id }}" {% if usuario_id == u.id %}selected{% endif %}>{{ u.full_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-sm mb-1">Data Início</label>
      <input type="date" name="data_inicio" value="{{ data_inicio }}" class="w-full border rounded px-3 py-2" />
    </div>
    <div>
      <label class="block text-sm mb-1">Data Fim</label>
      <input type="date" name="data_fim" value="{{ data_fim }}" class="w-full border rounded px-3 py-2" />
    </div>
    <div class="flex items-end">
      <button class="bg-blue-600 hover:bg-blue-700 text-white rounded px-4 py-2 w-full">Filtrar</button>
    </div>
  </div>
</form>

<div class="bg-white p-4 rounded shadow">
  <h2 class="font-semibold mb-3">Histórico de Operações (últimas 100)</h2>
  {% if logs %}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">Data/Hora</th>
            <th class="text-left py-2">Usuário</th>
            <th class="text-left py-2">Ação</th>
            <th class="text-left py-2">Tipo</th>
            <th class="text-left py-2">ID</th>
            <th class="text-left py-2">Detalhes</th>
          </tr>
        </thead>
        <tbody>
          {% for item in logs %}
            <tr class="border-t hover:bg-gray-50">
              <td class="py-2">{{ fmt_dt(item.log.created_at) }}</td>
              <td class="py-2">{{ item.usuario_nome }}</td>
              <td class="py-2 font-semibold">{{ item.log.action }}</td>
              <td class="py-2">{{ item.log.entity_type }}</td>
              <td class="py-2">{{ item.log.entity_id or '-' }}</td>
              <td class="py-2 text-xs text-gray-600">{{ item.log.details or '-' }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-gray-600">Nenhum log encontrado para os filtros selecionados.</div>
  {% endif %}
</div>

<div class="mt-4 text-sm text-gray-600">
  <p><strong>Tipos de ação:</strong></p>
  <ul class="list-disc ml-5">
    <li><code>delete_sale</code>: Exclusão de venda</li>
    <li><code>close_cash</code>: Fechamento de caixa</li>
    <li><code>create_user</code>: Criação de usuário</li>
  </ul>
</div>
{% endblock %}
